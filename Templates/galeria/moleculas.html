{% load static %}

<!-- molecules.html -->
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{% static '/styles/styl.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <title>Coleção</title>
</head>

<body>
    <nav class="navbar bg-dark text-black navbar-dark opacity-30 navbar-expand-sm sticky-top">
        <div class="container">
            <a href="" class="navbar-brand d-flex align-items-center">LABQFC</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#menuNavbar">
                <span class="navbar-toggler-icon"> </span>
            </button>
            <div class="navbar-collapse" id="menuNavbar">
                <div class="navbar-nav ms-auto">
                    <a href="{% url 'index' %}" class="nav-link">HOME</a>
                    <a href="{% url 'moleculas' %}" class="nav-link">MOLÉCULAS</a>
                    <a href="http://localhost/novoprojeto/login.php" class="nav-link">LOGIN</a>
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">SAIBA MAIS</a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li>
                            <a href="https://www.ufrn.br/" target="_blank" class="dropdown-item">Portal UFRN</a>
                        </li>
                        <li>
                            <a href="#" class="dropdown-item">LABQFC</a>
                        </li>
                    </ul>
                </div>

            </div>
        </div>
    </nav>
    <div class="grid-container1">
        <div class="grid-item1" id="tags">
            <p class="tags__titulo">Busque por tags:</p>
            <ul class="tags__lista">
                <li class="tags__tag"><a href="{% url 'buscar' %}?categoria=Synthetic">Synthetic</a></li>
                <li class="tags__tag"><a href="{% url 'buscar' %}?categoria=Natural">Natural</a></li>
                <li class="tags__tag"><a href="{% url 'buscar' %}?categoria=Drug">Drug</a></li>
            </ul>
        </div>
        <div class="grid-item1" id="busca__fundo">
            <form action="{% url 'buscar' %}">
                <input class="busca__input" type="text" name="buscar" placeholder="O que você procura?">
                <button type="submit" class="submit">
                    <img class="busca__icone" src="{% static '/assets/ícones/2x/search.png' %}" alt="ícone de search">
                </button>
            </form>
        </div>
    </div>
    <div class="grid-container2">
        <form action="{% url 'ordenar_moleculas' %}" method="get">
            <select name="ordenacao">
                <option value="nome">Ordenar por ID</option>
                <option value="peso_molecular">Ordenar por Peso Molecular</option>
                <option value="logp">Ordenar por LogP</option>
            </select>
            <button type="submit">Ordenar</button>
        </form>
        <section class="galeria">
            <div class="cards">
                <h2 class="cards__titulo">Navegue pela galeria</h2>
                <ul class="cards__lista">
                    {% if cards %}
                    {% for mol in cards %}
                    <li class="card">
                        <a href="{% url 'imagem' mol.id %}">
                            <div id="molViewer_{{ mol.id }}" style="width: 200px; height: 200px;"></div>
                        </a>
                        <div class="card__info">
                            <p class="card__titulo">{{ mol.nome }}</p>
                            <div class="card__texto">
                                <p class="card__descricao">{{ mol.categoria}}</p>
                                <span>
                                    <img src="{% static '/assets/ícones/1x/favorite_outline.png' %}"
                                        alt="ícone de coração">
                                </span>
                            </div>
                        </div>
                    </li>
                    {% endfor %}
                    {% else %}
                    <div class="imagem_texto">
                        <p>Moléculas não encontradas</p>
                    </div>
                    {% endif %}
                </ul>
            </div>
        </section>
    </div>
    <script src="https://3Dmol.org/build/3Dmol-min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script> <!-- Se jQuery não estiver incluído -->
    <script>
        // Função para inicializar o visualizador
        function initialize3Dmol(id) {
            var viewer = $3Dmol.createViewer($(`#molViewer_${id}`), {
                defaultcolors: $3Dmol.rasmolElementColors
            });

            // Ajuste a URL para chamar sua view `get_molecule_data`
            $.get('{% url "get_molecule_data" %}?id=' + id, function (data) {
                viewer.addModel(data.molblock, "sdf");
                viewer.setStyle({}, { stick: {} });
                viewer.zoomTo();
                viewer.render();
            }, 'json');
        }

        // Chamada após o carregamento da página
        $(document).ready(function () {
            {% for mol in cards %}
            initialize3Dmol({{ mol.id }});
        {% endfor %}
    });
    </script>
</body>
<footer class="rodape">
    <div class="rodape__icones">
        <a href="#" target=”_blank”>
            <img src="{% static '/assets/ícones/1x/twitter.png' %}" alt="ícone twitter">
        </a>
        <a href="#" target=”_blank”>
            <img src="{% static '/assets/ícones/1x/instagram.png' %}" alt="ícone instagram">
        </a>
    </div>
    <p class="rodape__texto">Desenvolvido por LABQFC</p>
</footer>

</html>